{% if not inline %}{% extends "social/social.html" %}
{% else %}{% set inline = None %}{% extends "includes/inline.html" %}{% endif %}

{% set group = resource.instance %}
{% set members=group.members() if group else [] %}

{% if resource.op_is_new() %}
  {% set title = "New group" %}
  {% set action_url = url_for('social.group_new', inline=inline) %}
{% else %}
  {% set title = group.name %}
  {% set action_url = url_for('social.group_detail', slug=group.slug, inline=inline) %}
  {% set fixed_recipients = True %} {# fixed recipients always when having exiting conversation #}
{% endif %}

{% block content_title %}{{title}}{% endblock %}

{% block content %}{% block inline %}
{% if resource.form %}<form method="post" action="{{action_url}}">{% endif %}
<div class="row m_inplace m_view{{ ' modal-body' if inline }}">
  <div class="span6">
    <div class="well">{{ resource.field('description', rows=10) }}</div>
    <table class="table">
      <tr><td><strong>Name</strong></td>
      <td>{{ resource.field('name') }}</td></tr>
      <tr><td><strong>Location</strong></td>
      <td><small>{{ resource.field('location') }}</small></td></tr>
      <tr><td><strong>Members</strong></td>
      <td><span class="badge">{{members.count() if group else 0}}</span></td></tr>
      <tr><td><strong>Meetings</strong></td>
      <td><span class="badge">0</span></td></tr>
    </table>
  </div>
  <div class="span6">
    {% include "social/group_member_view.html" %}
  </div>
</div>
{% if resource.form %}<div class="row form-actions">
    <button type="submit" class="btn btn-primary">Save changes</button>
    <a href="{{url_for('social.group_detail', slug=group.slug)}}" class="btn">Cancel</a>
    <a href="{{url_for('social.group_delete', slug=group.slug)}}" class="btn btn-danger">Delete</a>
    </div></form>{% endif %}

{% endblock %}{% endblock %}
{% extends "social/base.html" %}

{% block content_title %}All conversations{% endblock %}

{% block content %}
<table class="table table-striped">
  <thead>
    <tr>
      <th>Conversation</th>
      <th>Last activity</th>
      <th>Members</th>
    </tr>
  </thead>
  <tbody>
      {% for conversation in conversations %}
      <tr>
        <td>
        {% set lastmsg = conversation.last_message() %}
        {% if lastmsg %}
            <a href="{{ url_for('.conversation_get', conversation=conversation.id) }}"><em> {{lastmsg.content}}</em></a>
        {% else %}
            <a href="{{ url_for('.conversation_get', conversation=conversation.id) }}"><em> (empty) </em></a>         
        {% endif %}
        </td>
        <td>{{ conversation.modified_date.strftime('%Y-%m-%d %H:%M')}} </td>
        <td>
          {% set comma = joiner(', ') %} {# Outputs a comma every time except first time, makes nice comma list#}
          {% for member in conversation.members %}
            {{ comma() }}<a href="{{ url_for('.user_get', user=member.username) }}">{{ member.username }}</a>
          {% endfor %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<a href="{{ url_for('.conversation_get_new')}}" class="btn btn-primary">New conversation</a>
{% endblock %}

{% if template_parent %}{% extends template_parent %}
{% else %}{% extends "world/world_view.html" %}{% endif %}

{% if op == 'new' %}
  {% set tagline = world.title %}
  {% set title = 'New article!' %}
{% else %}
  {% set tagline = article.type_name() + " [" + world.title + "]" %}
  {% set title = article.title %}
{% endif %}

{% block content_title %}{{ title }}{% endblock %}
 
{% block content_tagline %}{{ tagline }}{% endblock %}

{% block sidebar %}
  {{ super() }}
  <h4>Alternatives</h4>
    <ul class="nav nav-list">
      {% if article %}
        <li><a href="{{ url_for('world.edit_article', world_slug=world.slug, article_slug=article.slug) }}">Edit</a></li>
        <li><a href="{{ url_for('world.delete_article', world_slug=world.slug, article_slug=article.slug) }}" class="m_action" data-action-type="modal">Delete</a></li>
      {% endif %}
        <li><a href="{{ url_for('world.new_article', world_slug=world.slug) }}">New</a></li>
    </ul>
{% endblock %}

{% block content %}{% block inline %}
{% if article_form %}
  <form method="post" action="{{ action_url }}">
  {% set article_type_name = article.type_name() if article else '' %}
  <div style="float: left">{{ article_form.title }}{{ article_form.type(class="m_action2") }}{{ article_form.world }}</div>
  <div id="personarticle_form"{{ ' class=hide' if article_type_name!='person' }}>{% include "models/personarticle_view.html" %}</div>
  <div id="mediaarticle_form"{{ ' class=hide' if article_type_name!='media' }}>{% include "models/mediaarticle_view.html" %}</div>
  <div id="eventarticle_form"{{ ' class=hide' if article_type_name!='event' }}>{% include "models/eventarticle_view.html" %}</div>
  <div id="placearticle_form"{{ ' class=hide' if article_type_name!='place' }}>{% include "models/placearticle_view.html" %}</div>
  <div class="edit">
    {{ article_form.content(rows=20, value="text") }}<br/>
  </div>
  <table>
    {% for articlerelation_form in article_form.outgoing_relations %}
      <tr><td><strong>{{article.title+' is' if not loop.last else 'New relation:'}}</strong></td>
        <td>{% include "models/articlerelation_view.html" %}</td>
      </tr>
    {% endfor %}
  </table>
  <div class="row form-actions">
    <button type="submit" class="btn btn-primary">Save changes</button>
    <a href="{{ url_for('world.index') }}" class="btn">Cancel</a>
  </div>
  </form>
{% else %}
  <div class="article">
  {{ article.content|wikify|markdown }}
  </div>
{% endif %}
{% endblock %}{% endblock %}

{% block row %}

{% endblock %}

{% block final %}
{{super()}}
<script>
    $(document).ready(function(){
        // Get the initial value
       var $el = $('.m_action2');
       $el.data('oldVal',  '#'+$el.find('option:selected').text()+'article_form' );

       $el.change(function(){
            //store new value
            var $this = $(this);
            var newValue = '#'+$this.find('option:selected').text()+'article_form'
            $(newValue).toggleClass('hide')
            $($this.data('oldVal')).toggleClass('hide')
            $this.data('oldVal', newValue) 
       })
//       .focus(function(){
//            // Get the value when input gains focus
//            var oldValue = $(this).data('oldVal');
//       });
    });
</script>
{% endblock %}
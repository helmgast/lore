{% extends "world/_page.html" %}

{% set groups = articles|dummygrouper %}

{% block cssimports %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}" type="text/css" media="print"/>
    <style media="print">
        .product {
            border-radius: 0;
            box-shadow: none;
            border: 1px solid gray;
            width: 230px;
            height: 324px;
            font-size: 11px;
        }

        .product-cover {
            max-height: 220px;
        }

        .product h3 {
            font-size: 14px;
            margin-bottom: 1px;
            margin-top: 3px;
        }

        .container, .content {
            padding: 0;
            margin: 0;
            float: none;
            width: 100%;
        }

        a {
            color: inherit;
        }

        .product:nth-child(9) {
            page-break-after: always;
        }

        .pagebreak {

            page-break-after: always;
        }

        .product-details, .page-header {
            display: none;
        }

    </style>
{% endblock %}

{% block breadcrumbs %}
    {% if world.slug == 'meta' %}
        {{ MACRO.BREADCRUMBS(
        (url_for('world.ArticlesView:publisher_home'), _('Home')),
        (url_for('world.ArticlesView:index', world_=world.slug), _('Articles'))
    ) }}
    {% else %}
        {{ MACRO.BREADCRUMBS(
    (url_for('world.ArticlesView:publisher_home'), _('Home')),
        (url_for('world.WorldsView:index'), _('Game Worlds')),
        (url_for('world.ArticlesView:world_home', world_=world.slug), world.title),
        (url_for('world.ArticlesView:index', world_=world.slug), _('Articles'))
    ) }}
    {% endif %}
{% endblock %}

{% block content_title %}{{ _('Articles in %(world)s', world=world.title) }}{% endblock %}
{% block content_tagline %}{% endblock %}

{% block asides %}{{ super() }}
    {% if filter_options %}
        {{ MACRO.LIST_CONTROLS(model, args, ['title', 'creator', 'type', 'created_date']) }}

        <h5>{% trans %}By world{% endtrans %}</h5>
        <div class="btn-set">
            {% for opt in filter_options['world'] %}
                {{ MACRO.ARG_LINK(opt[1],opt[0], combine=True) }}
            {% endfor %}
        </div>

        <h5>{% trans %}By type{% endtrans %}</h5>
        <div class="btn-set">
            {% for opt in filter_options['type'] %}
                {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
            {% endfor %}
        </div>

        <h5>{% trans %}By status{% endtrans %}</h5>
        <div class="btn-set">
            {% for opt in filter_options['status'] %}
                {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
            {% endfor %}
        </div>

        <h5>{% trans %}By created date{% endtrans %}</h5>
        <div class="btn-set">
            {% for opt in filter_options['created_date'] %}
                {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
            {% endfor %}
        </div>

        <h5>{% trans %}By tag{% endtrans %}</h5>
        <div class="btn-set">
            {% for opt in filter_options['tags'] %}
                {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
            {% endfor %}
        </div>

        <h5>{% trans %}Search text{% endtrans %}</h5>
        <form method="get">
            {# This will erase all other query parameters when submitted by HTML design #}
            <div class="input-group{{ ' has-success' if args['q'] }}">
                <input class="form-control input-sm" type="search" id='q' name='q'
                       placeholder="{{ _('Text') }}" value="{{ args['q']|escape }}">
                <span class="input-group-btn">
            <button class="btn btn-default btn-sm" type="submit">{% trans %}Search{% endtrans %}</button></span>
            </div>
        </form>
        </span>
    {% endif %}
{% endblock %}


{% block content %}
    <div>
        {% for group in groups %}
            {% set articles = group.list %}
            {% if group.grouper %}
                <h3>{{ _(group.grouper|capitalize) }}</h3>
            {% endif %}
            {% if not articles %}
                <div class="jumbotron text-center">
                    <h2>{{ _('No articles found') }}</h2>
                </div>
            {% elif args['view'] == 'list' %}

                {% for article in articles %}
                    {% include "world/article_list_view.html" %}
                {% endfor %}

            {% elif args['view'] == 'card' %}
                <div class="cards">
                    {% for article in articles %}
                        {% include "world/article_card_view.html" %}
                        {% if loop.index is divisibleby 9 %}</div>
                            <div class="pagebreak"></div>
                            <div class="cards">{% endif %}
                    {% endfor %}
                    </div>

            {% else %} {# ==table #}
                {% include "world/article_table_view.html" %}
            {% endif %}
        {% endfor %}

    </div>
    {% include "includes/pagination.html" %}
{% endblock %}
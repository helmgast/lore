{% extends "world/world_item.html" if not parent_template else parent_template %}

{% if request.args.get('group_by')=='type' %}
    {% set groups = articles|by_articletype %}
    {% set type_tab = ' class=active' %}
{% elif request.args.get('group_by')=='created_date' %}
    {% set groups = articles|by_time %}
    {% set time_tab = ' class=active' %}
{% elif request.args.get('group_by')=='title' %}
    {% set groups = articles|by_initials %}
    {% set title_tab = ' class=active' %}
{% endif %}

{% block pre_content %}
<h2 class="browseArticle">{{ _('Browse') }}</h2>
<ul class="nav nav-tabs content-menu">
    <li{{title_tab}}><a href="{{ url_for('.ArticlesView:index', world=world.slug, group_by='title') }}"><span class="glyphicon glyphicon-book"></span> {{ _('By title') }}</a></li>
    <li{{type_tab}}><a href="{{ url_for('.ArticlesView:index', world=world.slug, group_by='type') }}"><span class="glyphicon glyphicon-tag"></span> {{ _('By type') }}</a></li>
    <li{{time_tab}}><a href="{{ url_for('.ArticlesView:index', world=world.slug, group_by='created_date') }}"><span class="glyphicon glyphicon-calendar"></span> {{ _('By time') }}</a></li>
</ul>
{% endblock %}

{% block content %}
    <div>
    {% for group in groups %}
        <h3>{{ _(group.grouper|capitalize) }}</h3>
        <div class="row">
        {% for article in group.list %}
            <div class="media col-sm-6">
                <a href="{{url_for('.ArticlesView:get', world=world.slug, id=article.slug)}}">
                    <h4>{{ article.title }}
                    {%- if not article.is_published() -%}
                    <small>{{" ["+article.status_name()+"]"}}</small>
                    {%- endif %}
                    {%- if groupby=='title' -%}
                    <small>{{" ["+article.type+"]"}}</small>
                    {%- elif groupby=='time' -%}
                    <small>{{" ["+article.created_date.strftime('%Y-%m-%d %H:%M')+"]"}}</small>
                    {%- endif %}</h4>
                </a>
                {% if article.feature_image %}
                <a class="pull-left" href="{{url_for('.ArticlesView:get', world=world.slug, id=article.slug)}}">
                <img class="media-object" src="{{url_for('image_thumb', slug=article.feature_image.slug)}}">
                </a>
                {% endif %}

                {{ article.description if article.description else article.content[0:500]|markdown|striptags|truncate }}
                <a href="{{url_for('.ArticlesView:get', world=world.slug, id=article.slug)}}"><em style="white-space: nowrap;">{{ _('Read more') }}</em></a>
            </div>
        {% if not loop.last and loop.index is divisibleby 2 %}</div><div class="row">{% endif %}
        {% endfor %}
        </div>
    {% else %}
      {% if articles %}
        {% if args['view'] == 'list' %}
          {% for article in articles %}
          <a class="blog_header" href="{{url_for('world.ArticlesView:get', world=world.slug, id=article.slug)}}"><h3>{{ article. title}}</h3></a>
        	<ul class="list-inline article-meta" style="margin-bottom: 0px">
            <li title="{{ _('Created') }}"><span class="glyphicon glyphicon-calendar"></span> {{article.created_date.strftime('%Y-%m-%d') }} {{ _('by') }}</li>
        	<li title="{{ _('Creator') }}">
        	<span class="glyphicon glyphicon-user"></span>
        	{{article.creator if article.creator else 'System'}}
        	</li>
        	</ul>
        	<div class="media">
        	{% if article.feature_image %}
          	<a class="pull-left" href="{{url_for('world.ArticlesView:get', world=world.slug, id=article.slug)}}">
          	<img class="media-object" src="{{url_for('image_thumb', slug=article.feature_image.slug)}}">
        		</a>
        	{% endif %}
        		<div class="media-body">
        			{% if article.description %}{{article.description}}{% else %}{{article.content[0:500]|markdown|striptags|truncate}}{% endif %}
        			<a href="{{url_for('world.ArticlesView:get', world=world.slug, id=article.slug)}}"><em style="white-space: nowrap;">{{ _('Read more') }}</em></a>
        		</div>
        	</div>
          {% endfor %}
        {% elif args['view'] == 'card' %}
          {% for article in articles %}
          <div class="col-md-4 product">
              {% if article.feature_image %}<a href="{{url_for('.ArticlesView:get', world=world.slug, id=article.slug)}}"><img class="product-image" src="{{url_for('image_thumb', slug=article.feature_image.slug)}}"></a>{% endif %}
              <ul class="product-details">
                  <li class="product-type">{{article.type}} {{article.created_date.strftime('%Y-%m-%d')}}</li>
              </ul>
              <div class="product-intro">
                  <h3><a href="{{url_for('.ArticlesView:get', world=world.slug, id=article.slug)}}">{{ article.title }}</a></h3>
                  <p>{{ article.description if article.description else article.content[0:500]|markdown|striptags|truncate }}</p>
              </div>
          </div>
          {% endfor %}
        {% else %}
        <table class="table table-hover">
          {{ MACRO.TABLE_HEADER(articles[0].__class__, ['title', 'creator', 'type', 'created_date']) }}
          <tbody>
            {% for article in articles %}
            <tr>
              <td><a href="{{ url_for('.ArticlesView:get', id=article.slug, world=world.slug, intent='patch')}}">{{article.title}}</a></td>
              <td>{{article.creator}}</td>
              <td>{{article.type}}</td>
              <td class="small">{{article.created_date.strftime('%Y-%m-%d %H:%M')}}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      {% else %}
      <div class="jumbotron text-center">
      <h2>{{ _('No articles yet!') }}</h2>
      </div>
      {% endif %}
    {% endfor %}
    </div>
    {% include "includes/pagination.html" %}
{% endblock %}

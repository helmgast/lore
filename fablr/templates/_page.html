<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}{{ self.content_title() }}{% endblock %}</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/icon/favicon.ico') }}">
    {% if args and args.get('intent',None) %}
        {#            Turn off Pinterest pinning from image galleries on editable pages#}
        <meta name="pinterest" content="nopin"/>
    {% endif %}

    {% block opengraph %}
        <meta name="twitter:card" content="summary">
        <meta property="og:type" content="website"/>
        <meta name="twitter:site" content="@helmgast">
        <meta name="twitter:url" property="og:url" content="{{ current_url(_external=true, _scheme='') }}">
        <meta name="twitter:title" property="og:title" content="{{ self.content_title() }}">
        <meta name="twitter:description" property="og:description" content="">
        <meta name="twitter:image" property="og:image"
              content="{{ url_for('static', filename='img/helmgast_512px.png', _external=true, _scheme='') }}">
    {% endblock %}

    {% block cssimports %}
        <link rel="stylesheet" href="{{ url_for('static', filename=assets['app.css']) }}">
    {% endblock %}

    {% block jsimports %}
        {% if not debug %}
            <script>
                window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments)
                        };
                ga.l = +new Date;
                ga('create', 'UA-49513153-1', 'none')
                ga('send', 'pageview');
            </script>
            <script async src='https://www.google-analytics.com/analytics.js'></script>
        {% endif %}

    {% endblock jsimports %}
</head>

{% import 'includes/macros.html' as MACRO %}

<body class="{% block body_class %}admin{% endblock %}">

{% block navbar %}
    <div class="navbar navbar-default navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            {% block navbar_brand %}
                <a class="navbar-brand" href="{{ url_for('world.homepage') }}">
                    Fablr
                    <small>{{ _('a story engine') }}</small>
                </a>
            {% endblock navbar_brand %}
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-nav-top">
                {% block navbar_left %}
                    {% call(privileged) MACRO.IS_ADMIN() %}
                        <li{% block publishers_active %}{% endblock %}>
                            <a href="{{ url_for('world.PublishersView:index') }}">
                                <span class="glyphicon glyphicon-asterisk"></span> {{ _('Publishers') }}
                            </a>
                        </li>
                    {% endcall %}
                    {% call(privileged) MACRO.AUTHORIZED(access_policy['user'].authorize('list', user)) %}
                        <li class="dropdown {% block social_active %}{% endblock %}">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false"><span
                                    class="glyphicon glyphicon-user"></span> {{ _('Users') }} <span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">

                                <li><a class="{{ privileged }}" href="{{ url_for('social.UsersView:index') }}"><span
                                        class="glyphicon glyphicon-bullhorn"></span> {{ _('Browse') }}</a></li>
                                <li role="separator" class="divider"></li>

                                <li><a class="{{ privileged }}" href="{{ url_for('social.GroupsView:index') }}"><span
                                        class="glyphicon glyphicon-globe"></span> {{ _('Groups') }}</a></li>
                                {% call(privileged) MACRO.IS_ADMIN() %}
                                    <li role="separator" class="divider"></li>
                                    <li role="presentation">
                                        <a class="{{ privileged }}" data-toggle="modal" data-target="#themodal"
                                           role="menuitem" tabindex="-1" href=
                                                   "{{ url_for('mail.mail_view', mail_type='invite', intent='post') }}">
                                            <span class="glyphicon glyphicon-hand-right"></span> {{ _('Invite user') }}
                                        </a>
                                    </li>
                                {% endcall %}
                            </ul>
                        </li>
                    {% endcall %}
                {% endblock navbar_left %}
            </ul>
            <ul class="nav navbar-nav navbar-right">

                {% block navbar_right %}
                    {% if not session.logged_in %}
                        <li><a href="{{ url_for('auth.login', next=request.path) }}">{{ _('Log In') }}</a></li>
                        {% call MACRO.IS_ENABLED("join") %}
                            <li><a href="{{ url_for('auth.join') }}">{{ _('Join') }}</a></li>
                        {% endcall %}
                    {% else %}
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false"><span
                                    class="glyphicon glyphicon-user"></span> {{ g.user }} <span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a {% call MACRO.IS_USER() %}href="{{ url_for('social.UsersView:get', id=g.user.identifier()) }}"{% endcall %}> {{ _('Profile') }}</a>
                                </li>
                                {% if publisher %}
                                {% call(privileged) MACRO.AUTHORIZED(access_policy['order'].authorize('my_orders')) %}
                                    <li><a class="{{ privileged }}" href="{{ url_for('shop.OrdersView:my_orders', publisher=publisher.slug) }}">{{ _('My orders') }}</a></li>
                                {% endcall %}
                                {% endif %}

                                {% call(privileged) MACRO.IS_ADMIN() %}
                                    <li role="separator" class="divider"></li>
                                    <li><a class="privileged"
                                           href="{{ url_for('assets.FileAssetsView:index') }}">{{ _('Files') }}</a>
                                    </li>
                                {% endcall %}
                                <li role="separator" class="divider"></li>
                                <li><a href="{{ url_for('auth.logout', next='/') }}">{{ _('Log Out') }}</a></li>
                            </ul>
                        </li>
                    {% endif %}
                {% endblock navbar_right %}
            </ul>
        </div>
    </div>
    <button class="betaribbon" data-toggle="modal" data-target="#feedback-modal">
        <span class="glyphicon glyphicon-exclamation-sign"></span> {% trans %}Give feedback{% endtrans %}!<br><span
            style="font-variant: small-caps">Beta</span>
    </button>
    {% include "includes/flash.html" %}

{% endblock navbar %}

{% block cover %}
{% endblock %}

<div class="{% block container_class %}container main{% endblock %}">
    {% block mainblock %}
        <div class="col-md-3 sidebar">
            {% block sidebar %}
                &nbsp;
            {% endblock %}
            {% block sidebar_end %}
            {% endblock %}
        </div>
        <!-- /sidebar -->

        <div class="col-md-9 content">
            {% block middle %}
                {% block pre_content %}
                    {% block hero_box %}{% endblock %}
                    <div class="page-header">
                        <h1>{% block content_title %}{% endblock %}
                            <small>{% block content_tagline %}{% endblock %}</small>
                        </h1>
                        {% block content_subheader %}{% endblock %}
                    </div>
                {% endblock pre_content %}
                {% block content %}{% endblock content %}
            {% endblock middle %}
            <!-- /content -->
        </div>
    {% endblock mainblock %}
</div>
<footer>
    <div class="container">
        {% block footer %}{% endblock %}
        <div class="row">
            <p>
                {% trans %}Design and code{% endtrans %} Â© {% filter currentyear %}{% endfilter %} Helmgast AB<br>
                Version {{ config['VERSION'] }}
            </p>
        </div>
    </div>
</footer>
{% include "includes/feedback_modal.html" %}
{# Standard modal element, don't touch #}
{# TODO data-remote='' cancels out remote setting from data-toggle=modal to stop remote loading#}
<div class="modal fade" id="themodal" data-remote="" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">Modal loading...</div>
    </div>
</div>
<script>
    // Global defaults. Be careful to change as lots of JS depends on it!
    // TODO some of below will be unique for each request, stopping caching
    var IMAGE_URL = "{{  url_for('image', slug = 'replace') }}"
    var STATIC_URL = "{{  url_for('static', filename = 'replace') }}"
    var IMAGE_SELECT_URL = "{{ url_for('assets.FileAssetsView:index', out='fragment', intent='patch', view='card',
                    type='image', choice='multiple')|safe }}"
    var CSRF_TOKEN = "{{ csrf_token() }}"
    var ROLLBAR_CONFIG = {
        accessToken: "ea27a30c22ca4e62a506af0ee4e581a5",
        captureUncaught: true,
        captureUnhandledRejections: true,
        payload: {
            environment: "fablr",
            person: {
                {% if g.user %}
                    id: "{{ g.user.id }}",
                    email: "{{ g.user.email }}",
                {% else %}
                    id: "{{ request.remote_addr }}"
                {% endif %}
            }
        }
    };
</script>

{% block final %}
    <script src="{{ url_for('static', filename=assets['app.js'], _external=true, _scheme='') }}"></script>
{% endblock %}
</body>
</html>

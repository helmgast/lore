<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}{{ self.content_title() }}{% endblock %}</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/icon/favicon.ico') }}">
    {% if args and args.get('intent',None) %}
        {#            Turn off Pinterest pinning from image galleries on editable pages#}
        <meta name="pinterest" content="nopin"/>
    {% endif %}

    {% block opengraph %}
        <meta name="twitter:card" content="summary">
        <meta property="og:type" content="website"/>
        <meta name="twitter:site" content="@helmgast">
        <meta name="twitter:url" property="og:url" content="{{ current_url(_external=true, _scheme='') }}">
        <meta name="twitter:title" property="og:title" content="{{ self.content_title() }}">
        <meta name="twitter:description" property="og:description" content="">
        <meta name="twitter:image" property="og:image"
              content="{{ url_for('static', filename='img/helmgast_512px.png', _external=true, _scheme='') }}">
    {% endblock %}

    {% block cssimports %}
        <link rel="stylesheet" href="{{ url_for('static', filename=assets['app.css']) }}">
    {% endblock %}

    {% block jsimports %}
        {% if not debug %}
            <script>
                window.ga = window.ga || function () {
                        (ga.q = ga.q || []).push(arguments)
                    };
                ga.l = +new Date;
                ga('create', 'UA-49513153-1', 'none')
                ga('send', 'pageview');
            </script>
            <script async src='https://www.google-analytics.com/analytics.js'></script>
        {% endif %}

    {% endblock jsimports %}
</head>

{% import 'includes/macros.html' as MACRO %}

<body>

{% block navbar %}
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            {% block navbar_brand %}
                <a class="navbar-brand" href="{{ url_for('world.homepage') }}">
                    <svg class="fablr-icon" style="fill: #a00; margin-top: -27px; width: 96px; height: 128px;">
                        <use xlink:href="#fablr-asterisme"></use>
                    </svg>
                </a>
            {% endblock navbar_brand %}
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-nav-top">
                {% block navbar_left %}
                    {% call(privileged) MACRO.IS_ADMIN() %}
                        <li{% block publishers_active %}{% endblock %}>
                            <a href="{{ url_for('world.PublishersView:index') }}">
                                <span class="glyphicon glyphicon-asterisk"></span> {{ _('Publishers') }}
                            </a>
                        </li>
                    {% endcall %}
                    {% call(privileged) MACRO.AUTHORIZED(access_policy['user'].authorize('list', user)) %}
                        <li{% block social_active %}{% endblock %}>
                            <a href="{{ url_for('social.UsersView:index') }}">
                                <span class="glyphicon glyphicon-user"></span> {{ _('Users') }} </a>
                        </li>
                    {% endcall %}
                {% endblock navbar_left %}
            </ul>

            <ul class="nav navbar-nav navbar-nav-top navbar-right">
                {#                <form class="navbar-form navbar-left" role="search">#}
                {#                    <div class="form-group">#}
                {#                        <input class="form-control input-sm" type="text" class="form-control" placeholder="Search">#}
                {#                    </div>#}
                {#                </form>#}
                {% block navbar_right %}

                    {% if not session.logged_in %}
                        <li><a href="{{ url_for('auth.login', next=request.path) }}">{{ _('Log In') }}</a></li>
                        {% call MACRO.IS_ENABLED("join") %}
                            <li><a href="{{ url_for('auth.join') }}">{{ _('Join') }}</a></li>
                        {% endcall %}
                    {% else %}
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false"><span
                                    class="glyphicon glyphicon-user"></span> {{ g.user }} <span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a {% call MACRO.IS_USER() %}href="{{ url_for('social.UsersView:get', id=g.user.identifier()) }}"{% endcall %}> {{ _('Profile') }}</a>
                                </li>
                                {% if publisher %}
                                    {% call(privileged) MACRO.AUTHORIZED(access_policy['order'].authorize('my_orders')) %}
                                        <li><a class="{{ privileged }}"
                                               href="{{ url_for('shop.OrdersView:my_orders', publisher=publisher.slug) }}">{{ _('My orders') }}</a>
                                        </li>
                                    {% endcall %}
                                {% endif %}

                                {% call(privileged) MACRO.IS_ADMIN() %}
                                    <li role="separator" class="divider"></li>
                                    <li><a class="privileged"
                                           href="{{ url_for('assets.FileAssetsView:index') }}">{{ _('Files') }}</a>
                                    </li>
                                {% endcall %}
                                <li role="separator" class="divider"></li>
                                <li><a href="{{ url_for('auth.logout', next='/') }}">{{ _('Log Out') }}</a></li>
                            </ul>
                        </li>
                    {% endif %}
                {% endblock navbar_right %}
            </ul>
        </div>
        <div class="collapse navbar-collapse navbar-sub">
            <ul class="nav navbar-nav">
                {% block subnavbar %}

                {% endblock %}
                {% block subnavbar_end %}
                {% endblock %}
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="breadcrumb-item nobr">{% block breadcrumbs %}{% endblock %}
                </li>
                {#                <li><p class="privileged">&nbsp;</p></li>#}
                <li>
                    <ul class="action-buttons">
                        {% block actionbar %}
                        {% endblock actionbar %}
                    </ul>
                </li>

            </ul>
        </div>

    </nav>
    <button class="betaribbon" data-toggle="modal" data-target="#feedback-modal">
        <span class="glyphicon glyphicon-exclamation-sign"></span> {% trans %}Give feedback{% endtrans %}!<br><span
            style="font-variant: small-caps">Beta</span>
    </button>
    {% include "includes/flash.html" %}

{% endblock navbar %}

{% block pre_content %}
    <div class="page-header {% block header_class %}{% endblock %}">
        <div class="container">
            <div class="row">
                {% block page_header %}
                    <h1 class="col-lg-offset-2 col-lg-10 col-md-12 col-sm-12">{% block content_title %}{% endblock %}
                        <small class="nobr">{% block content_tagline %}{% endblock %}</small>
                    </h1>
                {% endblock page_header %}
            </div>
        </div>
    </div>
{% endblock pre_content %}


<div class="container">
    {% block mainblock %}
        <div class="row">
            <aside class="col-lg-2 col-md-12 col-sm-10 intro-aside">
                {% block intro %}
                {% endblock intro %}
            </aside>

            <div class="col-lg-7 col-md-8 col-sm-10 content">
                {% block content %}{% endblock content %}
            </div>

            <aside class="col-lg-3 col-md-4 col-sm-10 article-aside">
                {% block asides %}
                {% endblock asides %}
                {% block asides_end %}
                {% endblock asides_end %}
            </aside>
        </div>
    {% endblock mainblock %}
</div>

{% block post_content %}
{% endblock post_content %}

<footer>
    <div class="container">
        {% block footer %}{% endblock %}
        <p>
            {% trans %}Design and code{% endtrans %} Â© {% filter currentyear %}{% endfilter %} Helmgast AB<br>
            Version {{ config['VERSION'] }}
        </p>
    </div>
</footer>
{% include "includes/feedback_modal.html" %}
{# Standard modal element, don't touch #}
{# TODO data-remote='' cancels out remote setting from data-toggle=modal to stop remote loading#}
<div class="modal fade" id="themodal" data-remote="" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">Modal loading...</div>
    </div>
</div>
<script>
    // Global defaults. Be careful to change as lots of JS depends on it!
    // TODO some of below will be unique for each request, stopping caching
    var IMAGE_URL = "{{  url_for('image', slug = 'replace') }}"
    var STATIC_URL = "{{  url_for('static', filename = 'replace') }}"
    var IMAGE_SELECT_URL = "{{ url_for('assets.FileAssetsView:index', out='fragment', intent='patch', view='card',
                    type='image', choice='multiple')|safe }}"
    var CSRF_TOKEN = "{{ csrf_token() }}"
    var ROLLBAR_CONFIG = {
        accessToken: "ea27a30c22ca4e62a506af0ee4e581a5",
        captureUncaught: true,
        captureUnhandledRejections: true,
        payload: {
            environment: "fablr",
            person: {
                {% if g.user %}
                    id: "{{ g.user.id }}",
                    email: "{{ g.user.email }}",
                {% else %}
                    id: "{{ request.remote_addr }}"
                {% endif %}
            }
        }
    };
</script>

{% block final %}
    <script src="{{ url_for('static', filename=assets['app.js'], _external=true, _scheme='') }}"></script>
{% endblock %}
</body>
</html>

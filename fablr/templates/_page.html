{% if not inline %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!--[if IE]><![endif]-->

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>{% block title %}{{ self.content_title() }}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/icon/favicon.ico') }}">
    {% block opengraph %}
    <meta name="twitter:card" content="summary">
    <meta property="og:type" content="website" />
    <meta name="twitter:site" content="@helmgast">
    <meta name="twitter:url" property="og:url" content="{{ current_url(_external=true) }}">
    <meta name="twitter:title" property="og:title" content="{{ self.content_title() }}">
    <meta name="twitter:description" property="og:description" content="">
    <meta name="twitter:image" property="og:image" content="{{ url_for('static', filename='img/helmgast_512px.png', _external=true) }}">
    {% endblock %}

{% block cssimports %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/datepicker.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chosen.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.calendar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nestable.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/imagelightbox.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/zenstyle.css') }}">
{#    <style>
      .privileged>a:hover:before {
        content: "{{_('Not all users can see this')}}";
      }
    </style>
#}
{#    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.dynatable.css') }}"> #}
{% endblock %}
{% block jsimports %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  //ga('create', 'UA-49513153-1', 'helmgast.se');
  ga('create', 'UA-49513153-1', 'none')
  ga('send', 'pageview');

{% if not 'DEBUG' in config %}
window.onerror = function(err, url, line, col, trace) {
  //Submit any errors to analytics
  ga('send', 'event', 'error' , url+':'+line+','+col, err + ' trace: ' + trace);
  console.log(err)
  return true; //continue error handlers
}
{% endif %}
</script>

<script>
  var i18n={
    'Drag or click to upload file':"{{_('Drag or click to upload file')}}",
    'Image URL':"{{_('Image URL')}}",
    'Caption':"{{_('Caption')}}",
    'Select from library':"{{_('Select from library')}}"
  }
</script>
    <script src="{{ url_for('static', filename='js/jquery-2.1.3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.calendar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.nestable.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.hotkeys.js') }}"></script>
{#    <script src="{{ url_for('static', filename='js/bootstrap-wysiwyg.js') }}"></script>#}

     <script src="{{ url_for('static', filename='js/libs/head.min.js') }}"></script>
{#    <script src="{{ url_for('static', filename='js/libs/FileSaver.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/libs/Blob.js') }}"></script>#}
    <script src="{{ url_for('static', filename='js/libs/fullScreen.js') }}"></script>

    <script src="{{ url_for('static', filename='js/chosen.jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.nestable.js') }}"></script>
    <script src="{{ url_for('static', filename='js/imagelightbox.js') }}"></script>
{#    <script src="{{ url_for('static', filename='js/jquery.dynatable.js') }}"></script>
    <script src="{{ url_for('static', filename='js/list.min.js') }}"></script> #}

{% endblock jsimports %}
</head>

{% import 'includes/macros.html' as MACRO %}

<body class="{% block body_class %}admin{% endblock %}">

{% block navbar %}
<div class="navbar navbar-default navbar-fixed-top">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ url_for('world.homepage') }}"><img src="{{ url_for('static', filename='img/helmgast_512px.png') }}" style="width: 128px; height: 128px; margin-top: -35px">
        {#<small>{{ _('a story engine') }}</small>#}
      </a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-nav-top">
        <li{% block blog_active %}{% endblock %}><a href="{{ url_for('world.ArticlesView:blog', world='helmgast') }}"><span class="glyphicon glyphicon-asterisk"></span> {{ _('Blog') }}</a></li>

        {% call(privileged) MACRO.IS_ADMIN() %}
        <li{% block social_active %}{% endblock %}><a href="{{ url_for('social.index') }}"><span class="glyphicon glyphicon-bullhorn"></span> {{ _('Social') }}</a></li>
        {% endcall %}
        {% call MACRO.IS_ENABLED("campaign") %}
        <li{% block campaign_active %}{% endblock %}><a href="{{ url_for('campaign.index') }}"><span class="glyphicon glyphicon-flag"></span> {{ _('Campaign') }}</a></li>
        {% endcall %}
        {% call MACRO.IS_ENABLED("tools") %}
        <li{% block generator_active %}{% endblock %}><a href="#"><span class="glyphicon glyphicon-wrench"></span> {{ _('Tools') }}</a></li>
        {% endcall %}
        <li{% block ext_shop_active %}{% endblock %}><a href="http://webshop.helmgast.se" target="_blank"><span class="glyphicon glyphicon-shopping-cart"></span> {{ _('Shop') }}</a></li>
        {% call MACRO.IS_USER() %}
        <li{% block shop_active %}{% endblock %}><a href="{{ url_for('shop.index') }}"><span class="glyphicon glyphicon-list-alt"></span> {{ _('Order') }}</a></li>
        {% endcall %}
        {% call MACRO.IS_USER() %}
        <li{% block world_active %}{% endblock %}><a href="{{ url_for('world.WorldsView:index') }}"><span class="glyphicon glyphicon-globe"></span> {{ _('Worlds') }}</a></li>
        {% endcall %}
        <li ><a href="http://www.rollspel.nu/forum/neogames" target="_blank"><span class="glyphicon glyphicon-bullhorn"></span> {{ _('Forum') }}</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        {% block navbar_cart %}
        {% endblock %}
        {% if not session.logged_in %}
          <li><a href="{{ url_for('auth.login', next=request.path) }}">{{ _('log in') }}</a></li>
          {% call MACRO.IS_ENABLED("join") %}
             <li><a href="{{ url_for('auth.join') }}">{{ _('join') }}</a></li>
          {% endcall %}
        {% else %}
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-user"></span> {{ g.user }} <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a {% call MACRO.IS_USER() %}href="{{ url_for('social.user_view', user=g.user.identifier()) }}"{% endcall %}> {{ _('Profile') }}</a></li>
                {% call(privileged) MACRO.IS_ADMIN() %}
                <li role="separator" class="divider"></li>
                <li><a class="privileged" href="{{ url_for('assets.fileasset_list') }}">{{ _('Files') }}</a></li>
                <li><a class="privileged"href="{{ url_for('assets.imageasset_list') }}">{{ _('Image Gallery') }}</a></li>
                <li><a class="privileged" href="{{ url_for('admin') }}">{{ _('Admin') }}</a></li>
                {% endcall %}
                <li role="separator" class="divider"></li>
                <li><a href="{{ url_for('auth.logout', next='/') }}">{{ _('log out') }}</a></li>
              </ul>
            </li>
        {% endif %}
      </ul>
    </div>
</div>
<button class="betaribbon" data-toggle="modal" data-target="#feedback-modal">
  <span class="glyphicon glyphicon-exclamation-sign"></span> {% trans %}Give feedback{% endtrans %}!<br><span style="font-variant: small-caps">Beta</span>
</button>
{% endblock %}

<div class="{% block container_class %}container{% endblock %}">
  {% block mainblock %}
  <div class="col-md-3 sidebar">
  {% block sidebar %}
    &nbsp;
  {% endblock %}
  </div>
  <!-- /sidebar -->

  <div class="col-md-9">
    <div class="content">
      {% include "includes/flash.html" %}
      {% block middle %}
      {% block pre_content %}
      {% block hero_box %}{% endblock %}
      <div class="page-header">
        <h1>{% block content_title %}{% endblock %}
          <small>{% block content_tagline %}{% endblock %}</small>
        </h1>
        {% block content_subheader %}{% endblock %}
      </div>
      {% endblock pre_content %}
      {% block content %}{% endblock content %}
      {% endblock middle %}
    </div>
    <!-- /content -->
  </div>
  {% endblock mainblock %}
</div>
<footer>
{% block footer %}{% endblock %}
</footer>
{% include "includes/feedback_modal.html" %}
{# Standard modal element, don't touch #}
<div class="modal fade" id="themodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">Modal loading...</div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% block final %}
{% endblock %}
</body>
</html>
{# IMPORTANT this section activates if we have set the modal parameter
   That means we will not deliver a full page but merely a Bootstrap modal content
   we will still insert the normal content_title and content, so all inheriting
   templates should work almost automatically
#}
{% else %}
<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
  <h3>{{ self.content_title() }}</h3>
</div>
{% include "includes/flash.html " %}
{% block modal_body %}{% endblock %}
{% block modal_footer %}{% endblock %}
{% endif %}

{% extends "shop/_page.html" if not parent_template else parent_template %}

{% block content_title %}{{ _('Orders') }}{% endblock %}
{% block content_tagline %}{% endblock %}

{% set currencies = {
  'eur' : 'â‚¬ %s',
  'sek' : '%s :-'
} %}

{% block sidebar %}{{ super() }}
    {% if filter_options %}
    {{ MACRO.LIST_CONTROLS(model, args, ['id','user', 'created', 'updated','status', 'total_price']) }}

    <h5>{% trans %}By updated{% endtrans %}</h5>
    <div class="btn-set">
        {% for opt in filter_options['updated'] %}
            {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
        {% endfor %}
    </div>

    <h5>{% trans %}By total items{% endtrans %}</h5>
    <div class="btn-set">
        {% for opt in filter_options['total_items'] %}
            {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
        {% endfor %}
    </div>

    <h5>{% trans %}By total price{% endtrans %}</h5>
    <div class="btn-set">
        {% for opt in filter_options['total_price'] %}
            {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
        {% endfor %}
    </div>

    <h5>{% trans %}By status{% endtrans %}</h5>
    <div class="btn-set">
        {% for opt in filter_options['status'] %}
            {{ MACRO.ARG_LINK(opt.label, opt.kwargs) }}
        {% endfor %}
    </div>
    {% endif %}
{% endblock %}

{% block content %}

    {% if orders %}
        {% if args.get('view', 'table') == 'table' %}
            <table class="table table-hover">
                <thead>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'id') }}</th>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'user') }}</th>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'created') }}</th>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'updated') }}</th>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'status') }}</th>
                <th>{{ MACRO.ORDER_BY_LINK(model, args, 'total_price') }}</th>
                <th class="nobr">{{ MACRO.ORDER_BY_LINK(model, args, 'total_items') }}</th>
                </thead>
                <tbody>
                {% for order in orders %}
                    <tr>
                        <td>
                            <a href="{{ url_for('shop.OrdersView:get', publisher=publisher.slug, id=order.id) }}">{{ order }}</a>
                        </td>
                        <td>{{ order.user.username }}</td>
                        <td class="small">{{ order.created.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td class="small">{{ order.updated.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ order.get_field_display('status') }}</td>
                        <td>{{ currencies.get(order.currency,'%s') % order.total_price|currency }}</td>
                        <td>{{ order.total_items }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="cards">
                <div class="row">
                    {% for order in orders %}
                        <div class="col-md-4 product">
                            {% if order.order_lines[0].product.get_feature_image %}<img class="product-image"
                                                                                    src="{{ url_for('image_thumb', slug=order.order_lines[0].product.get_feature_image.slug) }}">
                                </a>{% endif %}
                            <div class="product-intro">
                                <h3>
                                    <a href="{{ url_for('shop.OrdersView:get', publisher=publisher.slug, id=order.id) }}">{{ order }}</a>
                                </h3>
                            </div>
                            <ul class="product-details">
                                <li class="product-type">{{ order.user.username }}</li>
                                <li class="product-type">{{ order.updated.strftime('%Y-%m-%d %H:%M') }}</li>
                                <li class="product-price">{{ currencies.get(order.currency,'%s') % order.total_price|currency }}</li>
                            </ul>
                        </div>
                        {% if loop.index is divisibleby 3 %}</div>
                            <div class="row">{% endif %}
                    {% endfor %}
                    </div>
            </div>
        {% endif %}
        {% include "includes/pagination.html" %}

    {% else %}
        <h3>{{ _('You have not made any orders yet!') }}</h3>
    {% endif %}
{% endblock %}
